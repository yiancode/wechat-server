# 微信登录配置指南

配置完成后，用户可以通过扫描公众号二维码、发送消息获取验证码来登录你的应用系统。

## 配置清单

### 1. 应用系统后台

在你的应用系统中配置以下信息：

| 配置项 | 值 | 说明 |
|--------|-----|------|
| WeChat Server 服务器地址 | `https://wx.example.com` | WeChat Server 的部署地址 |
| WeChat Server 访问凭证 | `your-api-token` | config.yaml 中配置的 api_token |
| 微信公众号二维码图片链接 | （填入公众号二维码图片 URL） | 用于前端展示 |

**启用微信登录功能**
- 在应用系统中开启微信登录选项

---

### 2. 微信公众平台

| 配置项 | 值 |
|--------|-----|
| URL | `https://wx.example.com/wechat/{your-app-id}` |
| Token | `your-wechat-token` |
| EncodingAESKey | 随机生成 |
| 消息加解密方式 | 明文模式 |

---

## 用户登录流程

```
1. 用户访问应用登录页面，选择"微信登录"
2. 页面显示公众号二维码
3. 用户扫码关注公众号
4. 用户向公众号发送任意消息
5. 公众号返回 6 位验证码（有效期 5 分钟）
6. 用户在登录页面输入验证码
7. 应用系统调用 WeChat Server API 验证验证码
8. 验证通过，获取用户 OpenID
9. 登录成功
```

---

## 测试验证

部署完成后，按以下顺序测试：

1. **服务健康检查**
   ```bash
   curl https://wx.example.com/health
   ```

2. **微信公众平台验证**
   - 提交服务器配置，验证通过后启用

3. **API 接口测试**
   ```bash
   # 测试获取验证码（用户向公众号发消息后）
   curl -H "Authorization: your-api-token" \
        "https://wx.example.com/api/wechat/user?code=123456&app_id=your_app_id"
   ```

4. **实际登录测试**
   - 访问应用登录页面
   - 使用微信扫码登录
   - 输入验证码完成登录
